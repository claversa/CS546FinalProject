<h1>Edit Profile</h1>

<head>
    <link rel="stylesheet" href="/public/createProfile.css" />
</head>


<form id="profile-form">
    <div>
        <label>First Name: <input type="text" id="first" name="first" value="{{first}}" disabled></label>
    </div>
    <div>
        <label>Last Name: <input type="text" id="last" name="last" value="{{last}}" disabled></label>
    </div>
    <div>
        <label>Username: <input type="text" id="username" name="username" value="{{username}}" disabled></label>
    </div>
    <div>
        <label>Email: <input type="email" id="email" name="email" value="{{email}}" disabled></label>
    </div>
    <div>
        <label>Gender: <input type="text" id="gender" name="gender" value="{{gender}}" disabled></label>
    </div>
    <div>
        <label>Measurement System: <input type="text" id="system" name="system" value="{{system}}" disabled></label>
    </div>
    <div>
        <label>Home State: <input type="text" id="state" name="state" value="{{state}}" disabled></label>
    </div>
    <div>
        <label>Birthday: <input type="number" id="birthday" name="birthday" value="{{birthday}}" disabled></label>
    </div>
    <div>
        <label>Social Media Platform: <input type="text" id="socialPlatform" name="socialPlatform"
                value="{{socialPlatform}}" disabled></label>
    </div>
    <div>
        <label>Social Media Handle: <input type="text" id="socialHandle" name="socialHandle" value="{{socialHandle}}"
                disabled></label>
    </div>
    <button type="button" id="edit-button">Edit</button>
    <button type="submit" id="save-button" disabled>Save</button>
</form>
<div id="response"></div>

<script>
    $(document).ready(function () {
        let readOnly = ['username', 'email', 'birthday'];
        // can edit when  "Edit" button  clicked
        $('#edit-button').on('click', function () {
            // at first enable everything
            $('input').prop('disabled', false);

            // then disable read-only
            readOnly.forEach(function (fieldID) {
                $('#' + fieldID).prop('disabled', true);
            });

            //save button
            $('#save-button').prop('disabled', false);
        });

        // Handle form submission
        $('#profile-form').on('submit', function (event) {
            event.preventDefault(); // Prevent submit

            // Collect form data
            let first = $('#first').val().trim();
            let last = $('#last').val().trim();
            let gender: $('#gender').val().trim();
            let system: $('#system').val().trim();
            let state: $('#state').val().trim();
            let socialHandle: $('#socialHandle').val().trim();

            // validate data HERE!!!!!!!
            if (!first) throw "Error: must provide first name";
            if (!last) throw "Error: must provide last name";
            if (!gender) throw "Error: must provide gender";
            if (!system) throw "Error: must provide system";
            if (!state) throw "Error: must provide state";
            if (!socialHandle) throw "Error: must provide socialHandle";


                let formData = {
                    first: first,
                    last: last,
                    username: username,
                    email: email,
                    gender: gender,
                    system: system,
                    state: state,
                    birthday: birthday,
                    socialHandle: socialHandle,
                };


            // Make an AJAX request to update the profile
            $.ajax({
                url: '/edit-profile', // DOES IT GO HERE????
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(formData), // Convert form data to JSON
                success: function (response) {
                    $('#response').text(response.message);
                    $('input').prop('disabled', true); // Disable the input fields
                    $('#save-button').prop('disabled', true); // Disable the save button
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    // Handle errors
                    console.log('Error:', textStatus, errorThrown);
                    $('#response').text('Error updating profile');
                }
            });
        });
    });
</script>